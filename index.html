<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Akademi Pro v2.0 - Tarih & Coğrafya</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&display=swap');
        
        :root {
            --primary: #f59e0b;
            --bg-dark: #0f172a;
            --card-bg: #1e293b;
        }

        body {
            font-family: 'Outfit', sans-serif;
            background: var(--bg-dark);
            color: white;
            overflow-x: hidden;
        }

        .custom-scrollbar::-webkit-scrollbar { width: 5px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: var(--bg-dark); }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #334155; border-radius: 10px; }

        .glass { background: rgba(30, 41, 59, 0.6); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.08); }
        .nav-item { transition: all 0.2s; cursor: pointer; border-radius: 14px; margin-bottom: 4px; }
        .nav-item:hover { background: rgba(245, 158, 11, 0.1); color: var(--primary); }
        .nav-item.active { background: var(--primary); color: var(--bg-dark); font-weight: 800; box-shadow: 0 4px 15px rgba(245, 158, 11, 0.3); }
        
        #main-map { height: 450px; border-radius: 24px; z-index: 10; }
        
        .animate-pop { animation: pop 0.3s ease-out; }
        @keyframes pop { 0% { transform: scale(0.95); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }

        /* AI Chat bubbles */
        .chat-container { height: 400px; display: flex; flex-direction: column; gap: 12px; }
        .bubble { padding: 12px 16px; border-radius: 20px; max-width: 85%; line-height: 1.5; font-size: 0.95rem; }
        .bubble-ai { background: #1e293b; align-self: flex-start; border-bottom-left-radius: 4px; border: 1px solid rgba(255,255,255,0.1); }
        .bubble-user { background: var(--primary); color: #000; align-self: flex-end; border-bottom-right-radius: 4px; font-weight: 500; }

        /* Pomodoro Timer */
        .timer-circle { width: 180px; height: 180px; border: 8px solid rgba(245, 158, 11, 0.1); border-top-color: var(--primary); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 2.5rem; font-weight: 800; transition: 1s linear; }
    </style>
</head>
<body class="flex flex-col lg:flex-row min-h-screen">

    <!-- SIDEBAR -->
    <aside id="sidebar" class="fixed lg:sticky top-0 left-0 h-screen w-72 bg-[#0a0f1e] border-r border-slate-800 z-[100] transition-transform -translate-x-full lg:translate-x-0 overflow-y-auto custom-scrollbar flex flex-col">
        <div class="p-6">
            <div class="flex items-center gap-3 mb-10">
                <div class="w-10 h-10 bg-amber-500 rounded-xl flex items-center justify-center shadow-lg shadow-amber-500/20">
                    <i class="fas fa-graduation-cap text-slate-900 text-xl"></i>
                </div>
                <h1 class="text-xl font-extrabold tracking-tighter uppercase italic">Akademi <span class="text-amber-500">Pro</span></h1>
            </div>

            <nav class="flex-1 space-y-1">
                <div onclick="switchView('dashboard')" id="nav-dashboard" class="nav-item p-4 flex items-center gap-4 active">
                    <i class="fas fa-chart-line w-5"></i> <span class="text-sm font-bold">Analiz Merkezi</span>
                </div>
                <div onclick="switchView('planner')" id="nav-planner" class="nav-item p-4 flex items-center gap-4">
                    <i class="fas fa-stopwatch w-5"></i> <span class="text-sm font-bold">Odak Modu</span>
                </div>
                <div onclick="switchView('lessons')" id="nav-lessons" class="nav-item p-4 flex items-center gap-4">
                    <i class="fas fa-book-open w-5"></i> <span class="text-sm font-bold">Konu Anlatımı</span>
                </div>
                <div onclick="switchView('quiz')" id="nav-quiz" class="nav-item p-4 flex items-center gap-4">
                    <i class="fas fa-brain w-5"></i> <span class="text-sm font-bold">Soru Bankası</span>
                </div>
                <div onclick="switchView('maps')" id="nav-maps" class="nav-item p-4 flex items-center gap-4">
                    <i class="fas fa-globe-africa w-5"></i> <span class="text-sm font-bold">Harita Atölyesi</span>
                </div>
                <div onclick="switchView('timeline')" id="nav-timeline" class="nav-item p-4 flex items-center gap-4">
                    <i class="fas fa-history w-5"></i> <span class="text-sm font-bold">Kronoloji</span>
                </div>
                <div onclick="switchView('ai')" id="nav-ai" class="nav-item p-4 flex items-center gap-4">
                    <i class="fas fa-magic w-5"></i> <span class="text-sm font-bold">AI Eğitimci</span>
                </div>
            </nav>
        </div>

        <div class="p-6 mt-auto">
            <div class="p-4 rounded-2xl bg-gradient-to-br from-amber-500/20 to-transparent border border-amber-500/20">
                <div class="flex items-center gap-2 mb-2 text-amber-500">
                    <i class="fas fa-crown text-xs"></i>
                    <span class="text-[10px] font-black uppercase tracking-wider">Premium Üyelik</span>
                </div>
                <p class="text-[11px] text-slate-400 mb-4 leading-tight">YKS ve KPSS müfredatına tam erişim kazanın.</p>
                <button onclick="showPremium()" class="w-full py-2 rounded-xl bg-amber-500 text-slate-900 text-[11px] font-black uppercase hover:scale-[1.02] transition-transform">ŞİMDİ YÜKSELT</button>
            </div>
        </div>
    </aside>

    <!-- ANA İÇERİK -->
    <main class="flex-1 p-4 lg:p-8 overflow-y-auto custom-scrollbar relative">
        
        <!-- ÜST BAR -->
        <header class="flex justify-between items-center mb-10">
            <div class="flex items-center gap-4">
                <button onclick="toggleSidebar()" class="lg:hidden p-3 bg-slate-800 rounded-xl">
                    <i class="fas fa-bars"></i>
                </button>
                <div>
                    <h2 id="view-title" class="text-2xl font-black italic uppercase">Analiz <span class="text-amber-500">Merkezi</span></h2>
                    <p class="text-[10px] text-slate-500 font-bold tracking-[0.2em] uppercase">Müfredat Ver. 2024.11 • Aktif</p>
                </div>
            </div>

            <div class="flex items-center gap-4">
                <div class="hidden md:flex flex-col items-end border-r border-slate-800 pr-4">
                    <span class="text-[10px] text-slate-500 font-black uppercase">Sınav Geri Sayımı</span>
                    <span class="text-xl font-black text-amber-500" id="countdown">--:--</span>
                </div>
                <div class="flex items-center gap-3 bg-slate-800/50 p-1.5 pr-4 rounded-2xl border border-slate-700">
                    <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Felix" class="w-10 h-10 rounded-xl bg-slate-700" alt="User">
                    <div class="hidden sm:block">
                        <p class="text-xs font-black uppercase leading-none mb-1">Ahmet Yılmaz</p>
                        <p class="text-[10px] text-emerald-500 font-bold">Sıralama: #1,204</p>
                    </div>
                </div>
            </div>
        </header>

        <div id="view-content" class="space-y-8">
            
            <!-- DASHBOARD -->
            <section id="view-dashboard" class="animate-pop">
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <div class="glass p-6 rounded-[2rem] border-slate-800 flex items-center gap-5">
                        <div class="w-14 h-14 bg-emerald-500/10 text-emerald-500 rounded-2xl flex items-center justify-center text-2xl"><i class="fas fa-bullseye"></i></div>
                        <div><p class="text-[10px] text-slate-500 font-black uppercase">TYT Net</p><h4 class="text-2xl font-black">92.25</h4></div>
                    </div>
                    <div class="glass p-6 rounded-[2rem] border-slate-800 flex items-center gap-5">
                        <div class="w-14 h-14 bg-blue-500/10 text-blue-500 rounded-2xl flex items-center justify-center text-2xl"><i class="fas fa-tasks"></i></div>
                        <div><p class="text-[10px] text-slate-500 font-black uppercase">Çözülen Soru</p><h4 class="text-2xl font-black">14,820</h4></div>
                    </div>
                    <div class="glass p-6 rounded-[2rem] border-slate-800 flex items-center gap-5">
                        <div class="w-14 h-14 bg-purple-500/10 text-purple-500 rounded-2xl flex items-center justify-center text-2xl"><i class="fas fa-hourglass-half"></i></div>
                        <div><p class="text-[10px] text-slate-500 font-black uppercase">Çalışma Saati</p><h4 class="text-2xl font-black">342s</h4></div>
                    </div>
                    <div class="glass p-6 rounded-[2rem] border-slate-800 flex items-center gap-5">
                        <div class="w-14 h-14 bg-amber-500/10 text-amber-500 rounded-2xl flex items-center justify-center text-2xl"><i class="fas fa-fire"></i></div>
                        <div><p class="text-[10px] text-slate-500 font-black uppercase">Günlük Seri</p><h4 class="text-2xl font-black">18 G</h4></div>
                    </div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <div class="lg:col-span-2 glass p-8 rounded-[2.5rem] shadow-2xl">
                        <div class="flex justify-between items-center mb-8">
                            <h3 class="font-black italic uppercase tracking-tight">Haftalık Gelişim</h3>
                            <select class="bg-slate-800 text-[10px] font-bold uppercase p-2 rounded-lg border border-slate-700 outline-none">
                                <option>Tarih</option>
                                <option>Coğrafya</option>
                                <option>Genel</option>
                            </select>
                        </div>
                        <canvas id="performanceChart" height="150"></canvas>
                    </div>
                    <div class="glass p-8 rounded-[2.5rem] shadow-2xl space-y-6">
                        <h3 class="font-black italic uppercase tracking-tight">Hızlı Erişim</h3>
                        <div class="space-y-4">
                            <div class="p-4 bg-slate-800/40 rounded-2xl border border-slate-700 hover:border-amber-500 transition-colors cursor-pointer group">
                                <div class="flex justify-between items-center">
                                    <span class="text-[10px] font-black uppercase text-amber-500">Tarih</span>
                                    <i class="fas fa-arrow-right text-[10px] opacity-0 group-hover:opacity-100 transition-opacity"></i>
                                </div>
                                <p class="text-sm font-bold mt-1">Lozan Barış Antlaşması</p>
                            </div>
                            <div class="p-4 bg-slate-800/40 rounded-2xl border border-slate-700 hover:border-blue-500 transition-colors cursor-pointer group">
                                <div class="flex justify-between items-center">
                                    <span class="text-[10px] font-black uppercase text-blue-500">Coğrafya</span>
                                    <i class="fas fa-arrow-right text-[10px] opacity-0 group-hover:opacity-100 transition-opacity"></i>
                                </div>
                                <p class="text-sm font-bold mt-1">Türkiye'nin Akarsu Rejimleri</p>
                            </div>
                            <div class="p-6 bg-gradient-to-br from-amber-500 to-orange-600 rounded-[2rem] text-slate-900">
                                <p class="text-[10px] font-black uppercase opacity-70">Günün Sözü</p>
                                <p class="text-sm font-extrabold italic mt-2">"Gelecek, bugünden ona hazırlananlarındır."</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- ODAK MODU (POMODORO) -->
            <section id="view-planner" class="hidden animate-pop">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <div class="glass p-10 rounded-[3rem] text-center flex flex-col items-center justify-center">
                        <h3 class="text-xl font-black uppercase italic mb-8">Odak Zamanlayıcı</h3>
                        <div class="timer-circle mb-8" id="timer-display">25:00</div>
                        <div class="flex gap-4">
                            <button onclick="toggleTimer()" id="timer-btn" class="px-8 py-4 bg-amber-500 text-slate-900 rounded-2xl font-black uppercase text-sm">Başlat</button>
                            <button onclick="resetTimer()" class="px-8 py-4 bg-slate-800 rounded-2xl font-black uppercase text-sm">Sıfırla</button>
                        </div>
                    </div>
                    <div class="glass p-10 rounded-[3rem]">
                        <h3 class="text-xl font-black uppercase italic mb-8">Bugünün Hedefleri</h3>
                        <div class="space-y-4" id="todo-list">
                            <!-- Tasks added dynamically -->
                            <div class="flex gap-4 items-center bg-slate-800/40 p-4 rounded-2xl border border-slate-700">
                                <input type="checkbox" class="w-5 h-5 accent-amber-500">
                                <span class="font-bold flex-1">Osmanlı Duraklama Dönemi Testi</span>
                            </div>
                            <div class="flex gap-4 items-center bg-slate-800/40 p-4 rounded-2xl border border-slate-700">
                                <input type="checkbox" class="w-5 h-5 accent-amber-500">
                                <span class="font-bold flex-1">Karstik Şekiller Harita Çalışması</span>
                            </div>
                        </div>
                        <div class="mt-8 flex gap-2">
                            <input type="text" id="new-task" placeholder="Yeni görev ekle..." class="flex-1 bg-slate-900 border border-slate-700 rounded-xl px-4 py-3 text-sm focus:border-amber-500 outline-none">
                            <button onclick="addTask()" class="p-4 bg-amber-500 text-slate-900 rounded-xl"><i class="fas fa-plus"></i></button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- AI ASİSTAN -->
            <section id="view-ai" class="hidden animate-pop">
                <div class="max-w-3xl mx-auto glass rounded-[3rem] overflow-hidden flex flex-col h-[600px]">
                    <div class="p-6 border-b border-slate-800 bg-slate-800/30 flex items-center justify-between">
                        <div class="flex items-center gap-4">
                            <div class="w-10 h-10 bg-amber-500 rounded-full flex items-center justify-center text-slate-900">
                                <i class="fas fa-robot"></i>
                            </div>
                            <div>
                                <h4 class="font-black uppercase text-sm">Akademi AI Asistan</h4>
                                <p class="text-[10px] text-emerald-500 font-bold">Online • Sorularını sorabilirsin</p>
                            </div>
                        </div>
                    </div>
                    <div id="ai-chat-box" class="flex-1 p-6 overflow-y-auto custom-scrollbar chat-container">
                        <div class="bubble bubble-ai">Merhaba! Ben Akademi Pro asistanı. Tarih veya Coğrafya konularında aklına takılan her şeyi bana sorabilirsin. Örneğin: "Malazgirt Savaşı'nın sonuçları nelerdir?"</div>
                    </div>
                    <div class="p-4 bg-slate-900/50 flex gap-2">
                        <input type="text" id="ai-input" placeholder="Bir soru sor..." class="flex-1 bg-slate-800 border border-slate-700 rounded-2xl px-6 py-4 outline-none focus:border-amber-500 text-sm">
                        <button onclick="askAI()" class="w-14 h-14 bg-amber-500 text-slate-900 rounded-2xl flex items-center justify-center hover:scale-105 transition-transform">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                </div>
            </section>

            <!-- HARİTA ATÖLYESİ -->
            <section id="view-maps" class="hidden animate-pop">
                <div class="bg-slate-900/50 p-6 rounded-[3rem] border border-slate-800">
                    <div class="flex flex-wrap gap-2 mb-6">
                        <button onclick="mapShow('daglar')" class="px-5 py-2.5 bg-emerald-500/10 border border-emerald-500/20 rounded-xl text-[10px] font-black uppercase text-emerald-500 hover:bg-emerald-500/20 transition-all">Sıradağlar</button>
                        <button onclick="mapShow('goller')" class="px-5 py-2.5 bg-blue-500/10 border border-blue-500/20 rounded-xl text-[10px] font-black uppercase text-blue-500 hover:bg-blue-500/20 transition-all">Göller & Akarsular</button>
                        <button onclick="mapShow('ovalar')" class="px-5 py-2.5 bg-orange-500/10 border border-orange-500/20 rounded-xl text-[10px] font-black uppercase text-orange-500 hover:bg-orange-500/20 transition-all">Ovalar & Platolar</button>
                        <button onclick="mapShow('volkanik')" class="px-5 py-2.5 bg-rose-500/10 border border-rose-500/20 rounded-xl text-[10px] font-black uppercase text-rose-500 hover:bg-rose-500/20 transition-all">Volkanik Dağlar</button>
                    </div>
                    <div id="main-map"></div>
                </div>
            </section>

            <!-- SORU BANKASI -->
            <section id="view-quiz" class="hidden animate-pop">
                <div class="max-w-2xl mx-auto" id="quiz-container">
                    <div class="flex justify-between items-center mb-6">
                        <div>
                            <span class="text-xs font-black uppercase text-amber-500" id="quiz-tag">Tarih • KPSS/YKS</span>
                            <h4 class="text-xl font-black italic uppercase" id="quiz-title">Günün Denemesi</h4>
                        </div>
                        <div class="text-right">
                            <span class="text-[10px] text-slate-500 font-bold uppercase block">Puan</span>
                            <span class="text-2xl font-black text-amber-500" id="quiz-score">0</span>
                        </div>
                    </div>
                    
                    <div class="glass p-10 rounded-[3rem] min-h-[400px] flex flex-col">
                        <div class="mb-4">
                            <span class="px-3 py-1 bg-slate-800 rounded-full text-[10px] font-black uppercase" id="q-progress">Soru 1 / 5</span>
                        </div>
                        <p class="text-lg font-extrabold leading-relaxed mb-10" id="q-text">Soru metni buraya gelecek...</p>
                        
                        <div class="grid grid-cols-1 gap-4 mt-auto" id="q-options">
                            <!-- Opsiyonlar dinamik gelecek -->
                        </div>
                    </div>
                </div>
            </section>

            <!-- DERS NOTLARI -->
            <section id="view-lessons" class="hidden animate-pop">
                <div class="flex gap-4 mb-10 overflow-x-auto pb-2 custom-scrollbar">
                    <button onclick="filterLesson('all')" class="px-6 py-2.5 rounded-xl bg-amber-500 text-slate-900 font-black uppercase text-[10px] whitespace-nowrap">Hepsi</button>
                    <button onclick="filterLesson('tarih')" class="px-6 py-2.5 rounded-xl bg-slate-800 font-black uppercase text-[10px] whitespace-nowrap">Tarih</button>
                    <button onclick="filterLesson('cografya')" class="px-6 py-2.5 rounded-xl bg-slate-800 font-black uppercase text-[10px] whitespace-nowrap">Coğrafya</button>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="lesson-grid">
                    <!-- Cards -->
                    <div class="glass p-6 rounded-[2rem] hover:border-amber-500 transition-all group lesson-card" data-cat="tarih">
                        <div class="w-12 h-12 bg-amber-500/10 text-amber-500 rounded-xl flex items-center justify-center mb-4"><i class="fas fa-landmark"></i></div>
                        <h4 class="font-black uppercase text-sm mb-2">I. Dünya Savaşı</h4>
                        <p class="text-xs text-slate-400 leading-relaxed mb-6">Nedenleri, cepheler ve savaşın sonuçlarına dair detaylı analizler.</p>
                        <button class="w-full py-3 bg-slate-800 rounded-xl text-[10px] font-black uppercase group-hover:bg-amber-500 group-hover:text-slate-900 transition-colors">Notları İncele</button>
                    </div>
                    <div class="glass p-6 rounded-[2rem] hover:border-blue-500 transition-all group lesson-card" data-cat="cografya">
                        <div class="w-12 h-12 bg-blue-500/10 text-blue-500 rounded-xl flex items-center justify-center mb-4"><i class="fas fa-cloud-sun"></i></div>
                        <h4 class="font-black uppercase text-sm mb-2">Türkiye İklim Tipleri</h4>
                        <p class="text-xs text-slate-400 leading-relaxed mb-6">Akdeniz, Karadeniz ve Karasal iklim özellikleri, yağış rejimleri.</p>
                        <button class="w-full py-3 bg-slate-800 rounded-xl text-[10px] font-black uppercase group-hover:bg-blue-500 group-hover:text-white transition-colors">Notları İncele</button>
                    </div>
                </div>
            </section>

        </div>
    </main>

    <!-- PREMIUM MODAL -->
    <div id="premium-modal" class="fixed inset-0 z-[200] bg-slate-950/95 backdrop-blur-xl flex items-center justify-center p-6 hidden">
        <div class="bg-[#0a0f1e] w-full max-w-xl rounded-[4rem] p-12 border border-amber-500/20 text-center animate-pop">
            <div class="w-24 h-24 bg-amber-500 rounded-3xl mx-auto flex items-center justify-center text-4xl text-slate-900 shadow-2xl shadow-amber-500/40 mb-8">
                <i class="fas fa-crown"></i>
            </div>
            <h2 class="text-4xl font-black italic mb-4 uppercase">PREMIUM'A GEÇ</h2>
            <p class="text-slate-400 mb-8 font-medium">Reklamsız deneyim, sınırsız AI soru sorma hakkı ve tüm PDF ders notları sizi bekliyor.</p>
            <div class="space-y-4 mb-10">
                <div class="flex items-center gap-4 text-left p-4 bg-slate-900/50 rounded-2xl border border-slate-800">
                    <i class="fas fa-check text-emerald-500"></i>
                    <span class="text-sm font-bold">Tüm Soru Bankasına Erişim</span>
                </div>
                <div class="flex items-center gap-4 text-left p-4 bg-slate-900/50 rounded-2xl border border-slate-800">
                    <i class="fas fa-check text-emerald-500"></i>
                    <span class="text-sm font-bold">Sınırsız AI Eğitim Desteği</span>
                </div>
            </div>
            <button onclick="simulatePurchase()" class="w-full bg-amber-500 text-slate-900 py-6 rounded-3xl font-black text-xl uppercase shadow-2xl hover:scale-105 transition-transform">AYLIK 99.99 ₺</button>
            <button onclick="hidePremium()" class="mt-6 text-slate-500 font-bold uppercase text-[10px] tracking-widest">Daha Sonra Belki</button>
        </div>
    </div>

    <!-- SCRIPTS -->
    <script>
        const apiKey = ""; // Gemini API Key will be handled by environment
        let currentView = 'dashboard';
        let mapInstance;
        let markers = [];
        let timerSeconds = 1500;
        let timerInterval;

        // Görünüm Yönetimi
        function switchView(viewId) {
            document.querySelectorAll('#view-content > section').forEach(s => s.classList.add('hidden'));
            document.getElementById(`view-${viewId}`).classList.remove('hidden');
            
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            const nav = document.getElementById(`nav-${viewId}`);
            if(nav) nav.classList.add('active');

            const titles = {
                dashboard: 'Analiz Merkezi', planner: 'Odak Modu', lessons: 'Konu Anlatımı',
                quiz: 'Soru Bankası', maps: 'Harita Atölyesi', timeline: 'Kronoloji', ai: 'AI Eğitimci'
            };
            document.getElementById('view-title').innerHTML = `${titles[viewId]} <span class="text-amber-500">Pro</span>`;
            
            if(viewId === 'maps') setTimeout(initMap, 200);
            if(viewId === 'quiz') startQuiz();
            
            if(window.innerWidth < 1024) toggleSidebar();
        }

        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('-translate-x-full');
        }

        // --- POMODORO LOGIC ---
        function updateTimerDisplay() {
            const m = Math.floor(timerSeconds / 60);
            const s = timerSeconds % 60;
            document.getElementById('timer-display').innerText = `${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
        }

        function toggleTimer() {
            const btn = document.getElementById('timer-btn');
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
                btn.innerText = "Devam Et";
                btn.className = "px-8 py-4 bg-emerald-500 text-slate-900 rounded-2xl font-black uppercase text-sm";
            } else {
                timerInterval = setInterval(() => {
                    if (timerSeconds > 0) {
                        timerSeconds--;
                        updateTimerDisplay();
                    } else {
                        clearInterval(timerInterval);
                        alert("Odaklanma süresi bitti! Mola ver.");
                    }
                }, 1000);
                btn.innerText = "Durdur";
                btn.className = "px-8 py-4 bg-rose-500 text-white rounded-2xl font-black uppercase text-sm";
            }
        }

        function resetTimer() {
            clearInterval(timerInterval);
            timerInterval = null;
            timerSeconds = 1500;
            updateTimerDisplay();
            document.getElementById('timer-btn').innerText = "Başlat";
            document.getElementById('timer-btn').className = "px-8 py-4 bg-amber-500 text-slate-900 rounded-2xl font-black uppercase text-sm";
        }

        function addTask() {
            const input = document.getElementById('new-task');
            if (!input.value) return;
            const div = document.createElement('div');
            div.className = "flex gap-4 items-center bg-slate-800/40 p-4 rounded-2xl border border-slate-700 animate-pop";
            div.innerHTML = `<input type="checkbox" class="w-5 h-5 accent-amber-500"><span class="font-bold flex-1">${input.value}</span>`;
            document.getElementById('todo-list').appendChild(div);
            input.value = "";
        }

        // --- AI ASİSTAN LOGIC ---
        async function askAI() {
            const input = document.getElementById('ai-input');
            const chatBox = document.getElementById('ai-chat-box');
            if (!input.value) return;

            const userText = input.value;
            chatBox.innerHTML += `<div class="bubble bubble-user animate-pop">${userText}</div>`;
            input.value = "";
            chatBox.scrollTop = chatBox.scrollHeight;

            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: userText }] }],
                        systemInstruction: { parts: [{ text: "Sen bir Tarih ve Coğrafya öğretmenisin. Öğrencilere kısa, öz ve öğretici cevaplar veriyorsun." }] }
                    })
                });
                const data = await response.json();
                const aiText = data.candidates?.[0]?.content?.parts?.[0]?.text || "Üzgünüm, şu an cevap veremiyorum.";
                chatBox.innerHTML += `<div class="bubble bubble-ai animate-pop">${aiText}</div>`;
            } catch (err) {
                chatBox.innerHTML += `<div class="bubble bubble-ai border-rose-500">Bir hata oluştu. Lütfen bağlantını kontrol et.</div>`;
            }
            chatBox.scrollTop = chatBox.scrollHeight;
        }

        // --- HARİTA LOGIC ---
        function initMap() {
            if (!mapInstance) {
                mapInstance = L.map('main-map').setView([39.0, 35.0], 6);
                L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
                    attribution: '&copy; CartoDB'
                }).addTo(mapInstance);
            }
            setTimeout(() => mapInstance.invalidateSize(), 300);
        }

        const mapData = {
            daglar: [[39.7, 44.3, "Ağrı Dağı"], [38.5, 35.4, "Erciyes Dağı"], [40.8, 41.3, "Kaçkar Dağları"], [37.2, 34.8, "Toroslar"]],
            goller: [[38.6, 42.9, "Van Gölü"], [38.8, 33.3, "Tuz Gölü"], [37.7, 31.5, "Beyşehir Gölü"]],
            ovalar: [[36.8, 35.3, "Çukurova"], [41.5, 35.9, "Bafra Ovası"], [37.8, 32.4, "Konya Ovası"]],
            volkanik: [[38.5, 43.1, "Nemrut Dağı"], [37.7, 34.2, "Hasan Dağı"], [38.3, 28.5, "Kula Volkanları"]]
        };

        function mapShow(type) {
            markers.forEach(m => mapInstance.removeLayer(m));
            markers = [];
            mapData[type].forEach(item => {
                const icon = L.divIcon({
                    className: 'custom-div-icon',
                    html: `<div class="w-4 h-4 rounded-full bg-amber-500 border-2 border-white shadow-lg"></div>`,
                    iconSize: [16, 16],
                    iconAnchor: [8, 8]
                });
                const m = L.marker([item[0], item[1]], {icon}).addTo(mapInstance).bindPopup(`<b class="text-slate-900">${item[2]}</b>`);
                markers.push(m);
            });
            const group = new L.featureGroup(markers);
            mapInstance.fitBounds(group.getBounds().pad(0.1));
        }

        // --- QUIZ LOGIC ---
        const questions = [
            { q: "Osmanlı Devleti'nde ilk anayasa olan Kanun-i Esasi hangi padişah döneminde ilan edilmiştir?", options: ["II. Abdülhamid", "Abdülmecid", "II. Mahmud", "I. Abdülhamid"], correct: 0 },
            { q: "Aşağıdaki göllerden hangisi Türkiye'nin en büyük tatlı su gölüdür?", options: ["Tuz Gölü", "Van Gölü", "Beyşehir Gölü", "Eğirdir Gölü"], correct: 2 },
            { q: "Hangisi Milli Mücadele döneminde imzalanan ilk antlaşmadır?", options: ["Lozan", "Gümrü", "Moskova", "Ankara"], correct: 1 },
            { q: "Türkiye'nin en yüksek noktası olan Ağrı Dağı hangi oluşum türüne girer?", options: ["Kıvrımlı", "Kırıklı", "Volkanik", "Plato"], correct: 2 },
            { q: "Divan-ı Hümayun'da padişahın tuğrasını çekme yetkisine sahip kişi kimdir?", options: ["Sadrazam", "Reis-ül Küttab", "Nişancı", "Defterdar"], correct: 2 }
        ];

        let currentQ = 0;
        let score = 0;

        function startQuiz() {
            currentQ = 0; score = 0;
            showQuestion();
        }

        function showQuestion() {
            const q = questions[currentQ];
            document.getElementById('q-progress').innerText = `Soru ${currentQ + 1} / ${questions.length}`;
            document.getElementById('q-text').innerText = q.q;
            document.getElementById('quiz-score').innerText = score;
            
            const optionsDiv = document.getElementById('q-options');
            optionsDiv.innerHTML = "";
            q.options.forEach((opt, idx) => {
                const btn = document.createElement('button');
                btn.className = "p-5 bg-slate-800 border border-slate-700 rounded-2xl font-bold text-left hover:border-amber-500 hover:bg-slate-700 transition-all animate-pop";
                btn.innerText = opt;
                btn.onclick = () => handleAnswer(idx);
                optionsDiv.appendChild(btn);
            });
        }

        function handleAnswer(idx) {
            const btns = document.querySelectorAll('#q-options button');
            btns.forEach(b => b.disabled = true);
            
            if (idx === questions[currentQ].correct) {
                btns[idx].classList.add('border-emerald-500', 'bg-emerald-500/20');
                score += 20;
            } else {
                btns[idx].classList.add('border-rose-500', 'bg-rose-500/20');
                btns[questions[currentQ].correct].classList.add('border-emerald-500');
            }

            setTimeout(() => {
                currentQ++;
                if (currentQ < questions.length) {
                    showQuestion();
                } else {
                    finishQuiz();
                }
            }, 1500);
        }

        function finishQuiz() {
            document.getElementById('quiz-container').innerHTML = `
                <div class="glass p-12 rounded-[3rem] text-center animate-pop">
                    <i class="fas fa-trophy text-6xl text-amber-500 mb-6"></i>
                    <h2 class="text-3xl font-black mb-2 uppercase italic">Test Tamamlandı!</h2>
                    <p class="text-slate-400 mb-8">Tebrikler, tüm soruları yanıtladın.</p>
                    <div class="text-5xl font-black text-amber-500 mb-10">${score} Puan</div>
                    <button onclick="location.reload()" class="px-10 py-4 bg-amber-500 text-slate-900 rounded-2xl font-black uppercase shadow-xl">Yeniden Dene</button>
                </div>
            `;
        }

        // --- DASHBOARD CHARTS ---
        function initCharts() {
            const ctx = document.getElementById('performanceChart').getContext('2d');
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['Pzt', 'Sal', 'Çar', 'Per', 'Cum', 'Cmt', 'Paz'],
                    datasets: [{
                        label: 'Net Ortalaması',
                        data: [72, 75, 78, 82, 80, 85, 92],
                        borderColor: '#f59e0b',
                        backgroundColor: 'rgba(245, 158, 11, 0.1)',
                        tension: 0.4,
                        fill: true,
                        pointRadius: 6,
                        pointBackgroundColor: '#f59e0b',
                        borderWidth: 3
                    }]
                },
                options: {
                    plugins: { legend: { display: false } },
                    scales: {
                        y: { grid: { color: 'rgba(255,255,255,0.05)' }, ticks: { color: '#64748b', font: { weight: 'bold' } } },
                        x: { grid: { display: false }, ticks: { color: '#64748b', font: { weight: 'bold' } } }
                    }
                }
            });
        }

        // UI Diğer
        function showPremium() { document.getElementById('premium-modal').classList.remove('hidden'); }
        function hidePremium() { document.getElementById('premium-modal').classList.add('hidden'); }
        function simulatePurchase() {
            alert("Ödeme simülasyonu başarılı! Tüm kilitler açıldı.");
            hidePremium();
        }

        function filterLesson(cat) {
            document.querySelectorAll('.lesson-card').forEach(card => {
                if (cat === 'all' || card.dataset.cat === cat) card.style.display = 'block';
                else card.style.display = 'none';
            });
        }

        window.onload = () => {
            initCharts();
            updateTimerDisplay();
            // Geri sayım
            let days = 142;
            document.getElementById('countdown').innerText = `${days} GÜN`;
        };
    </script>
</body>
</html>
